/* Copyright Amazon.com 2010 */
function limitedText(){if(this.value.length>this.limit){this.value=this.value.substring(0,this.limit)}document.getElementById(this.callbackId).value=(this.limit-this.value.length)}$(document).ajaxSend(function(c,b,a){if(typeof(AUTH_TOKEN)=="undefined"){return}if(a.type=="GET"){return}if(/authenticity_token=/.test(a.data)){return}a.data=((a.data)?a.data+"&":"")+"authenticity_token="+encodeURIComponent(AUTH_TOKEN)});var showK4pcPopup=true;var timeWidgetImages=[];var defaultPopoverOptions={loadingContent:"<div class='popoverLoading'><img src='https://images-na.ssl-images-amazon.com/images/G/01/javascripts/lib/popover/images/snake._V265110081_.gif' /></div>"};var RefreshFetcher=new function(){var g={};var h=false;var d=1;var c=function(l,k,i){var j="/refresh/flashcard_highlights/"+l;$.ajax({type:"get",url:j,dataType:"json",beforeSend:function(m){m.setRequestHeader("Accept","application/javascript")},success:function(n){var m;for(m in n){g[m]=n[m]}k()},error:function(m,o,n){if(i){i(m,o,n)}}})};var f=function(i){if(i){$("#reviewContent").removeClass("reviewContentPopular")}else{$("#reviewContent").addClass("reviewContentPopular")}};var b=function(l,m,j){$("#loadingSpinnerPersonal").addClass("hidden");$("#loadingSpinnerPopular").addClass("hidden");$("#reviewContentHidden").html(l);if($("#reviewContentHidden").find(".noReview").size()>0){$(".reviewContentWrapper").html($("#reviewContentHidden").html());$("#reviewNavigation").find(".cardNumber").html("&nbsp;");$("#reviewNavigation").find(".reviewPrevious").html("&nbsp;");$("#reviewNavigation").find(".reviewNext").html("&nbsp;")}else{$("#reviewNavigation").find(".cardNumber").html($("#newNav").find(".cardNumber").html());$("#reviewNavigation").find(".reviewPrevious").html($("#newNav").find(".reviewPrevious").html());$("#reviewNavigation").find(".reviewNext").html($("#newNav").find(".reviewNext").html());var i=$("#reviewContentHidden").find(".cardType").html();f(i==="personal");$(".reviewHighlightArea").html($("#reviewContentHidden").find(".reviewHighlightArea").html());if($("#reviewContentHidden").find(".bookAsin").html()!==$("#reviewContent").find(".bookAsin").html()){$(".reviewBookInfoArea").html($("#reviewContentHidden").find(".reviewBookInfoArea").html())}if(m){$("#reviewContent").find(".highlightReplace").html(j.text);var k=$("#reviewContent").find(".readMore");k.text(k.text()+j.display_start);k.attr("href",k.attr("href")+j.display_start)}$(".reviewHighlightArea").removeClass("hidden");$(".reviewBookInfoArea").removeClass("hidden")}};var a=function(i,k,j){if(i.status!==0){$("#loadingReview").addClass("hidden");$("#refreshError").removeClass("hidden")}};this.displayLoading=function(i){if($("#reviewContent").hasClass("reviewContentPopular")){$("#loadingSpinnerPersonal").addClass("hidden");$("#loadingSpinnerPopular").removeClass("hidden")}else{$("#loadingSpinnerPersonal").removeClass("hidden");$("#loadingSpinnerPopular").addClass("hidden")}$(".noReview").addClass("hidden");$(".reviewHighlightArea").addClass("hidden");if(i){$(".reviewBookInfoArea").addClass("hidden")}};this.loadByHash=function(m){var k=false;var l;var n;var i;if(m.length<1){l=window.location.href.split("/");i=l[l.length-1];n=l[l.length-2];m=n+"_"+i}var j=null;if(m==="no_more"){j="/refresh/nothing_to_add"}else{l=m.split("_");if(l.length>2&&l[2]==="more"){k=true}n=l[0];i=parseInt(l[1],10);j="/refresh/"+n+"/"+i+"/"+(new Date().getTime())}if(n==="f"){d=i}e(j,n==="f",i,k)};this.loadByURL=function(i){e(i,false)};var e=function(k,j,i,l){RefreshFetcher.displayLoading(false);if(j&&((!isNaN(i)&&!g[i])||(l&&g[i].text===undefined))){c(i,function(){e(k,j,i,l)},a)}else{$.ajax({type:"get",url:k,beforeSend:function(m){m.setRequestHeader("Accept","application/javascript")},success:function(m){b(m,j,g[i])},error:function(m,o,n){a(m,o,n)}})}}};function readyFunction(){var j=$.browser.msie&&$.browser.version<7;var g=j?"classic":"default";var r=function(B,A,C){if(B!==null){var z=$(B).parents("form")[0];if(z){A=z.action;C=B.title}else{if(B.href&&B.title){A=B.href;C=B.title}}}return $.extend({},defaultPopoverOptions,{ajaxSlideDuration:0,modal:true,showOnHover:false,destination:A+"&popover=1",windowMargin:10,width:700,closeEventInclude:"CLICK_OUTSIDE",cacheable:false,title:C,skin:j?"classic":"default",paddingLeft:0,paddingRight:0,paddingBottom:0})};$(".shoveler:not(.suppressed)").livequery(function(){var z=$(this).find("li").size();$(this).shoveler(function(A,B){},z,{nextButtonSelector:"a.next-button",prevButtonSelector:"a.prev-button"})});if($("#reviewContent").size()>0){if($("#reviewContent").hasClass("reviewFirstCard")){var y=$("#reviewContent").find("[name=reviewPosition]").attr("value");RefreshFetcher.loadByHash("f_"+y)}else{$.history.init(RefreshFetcher.loadByHash)}}$("a.reviewContent").livequery("click",function(){var B=this.href.split("/");var z=B[B.length-1];var C=B[B.length-2];var A=C+"_"+z;$.history.load(A);return false});$("a.reviewContentMore").livequery("click",function(){RefreshFetcher.displayLoading(true);$.ajax({type:"get",dataType:"json",url:this.href,beforeSend:function(z){z.setRequestHeader("Accept","application/javascript")},success:function(z){if(z.newUrlToLoad!=null){window.location=z.newUrlToLoad}else{var A="";if(z.firstAddedCard){A="f_"+z.firstAddedCard+"_more"}else{A="no_more"}$(".reviewBookInfoArea").addClass("hidden");$.history.load(A)}},error:function(z,B,A){displayError(z,B,A)}});return false});$("a.popWindow").livequery("click",function(){window.open(this.href,this.rel,"height=600,width=500,left=10,top=10,resizable=yes,scrollbars=yes,toolbar=no,menubar=no,location=no,directories=no,status=yes");return false});$("#ciUploadForm").livequery("submit",function(){$(".error").hide();var z=true;if(!$("input[name=file_1]").val()){$("#noFile").show();z=false}if(!$("input[name=terms]").is(":checked")){$("#noTC").show();z=false}return z});$("form.rjsProfileEdit").livequery(function(){var z=$(this);z.ajaxForm({dataType:"json",beforeSend:function(A){z.find(".error").hide();A.setRequestHeader("Accept","text/javascript");z.find(".successText").hide();z.find(".messageText").show();z.find("input, textarea").attr("disabled","disabled")},success:function(B){z.find(".messageText").hide();z.find("input, textarea").attr("disabled",null);if(B.errors){for(var D in B.errors){z.find("#"+D).siblings(".customError").html(B.errors[D]).show()}}else{if(B.updated){for(var C in B.updated){z.find("input[name="+C+"]")[0].value=B.updated[C]}}var A=z.parents(".profilePreferences");A.find(".needName").hide();A.find(".uploadLink").show();z.find(".successText").show()}},error:function(A,C,B){z.find(".messageText").hide();z.find("input, textarea").attr("disabled",null);z.find(".error").show()},resetForm:false})});$("a.deleteConfirm").livequery(function(){var A=$(this).parents(".deletable");var z=$.extend({},defaultPopoverOptions,{ajaxSlideDuration:0,modal:true,showOnHover:false,destination:this.href,windowMargin:5,width:350,closeEventInclude:"CLICK_OUTSIDE",cacheable:false,skin:g,location:function(E,C){var F={left:A.offset().left+A.width()-E.outerWidth()+20,top:A.offset().top+15};var B=F.top+E.outerHeight();var D=$(window).scrollTop()+$(window).height();var G=B-D;if(G>0){window.scrollBy(0,G)}return F},onShow:function(B){A.addClass("active")},onHide:function(B){A.removeClass("active")}});if(this.href.indexOf("is_post")!=-1){z.width=600}$(this).amazonPopoverTrigger(z)});$("form.rjsDeleteEvent").livequery(function(){var z=$(this);z.ajaxForm({dataType:"json",beforeSend:function(A){z.find(".error").hide();A.setRequestHeader("Accept","text/javascript")},success:function(A){z.find(".ap_custom_close").click();$("#event"+A.id).remove()},error:function(A,C,B){z.find(".ap_custom_close").click()},resetForm:false})});function t(B,z){B=B.get(0);if(B.setSelectionRange){B.setSelectionRange(z,z)}else{if(B.createTextRange){var A=B.createTextRange();A.collapse(true);A.moveEnd("character",z);A.moveStart("character",z);A.select()}}}function w(z){var A=$(z).parent().find(".saveButton");A.removeClass("saveButtonInactive");A.attr("disabled",false)}function a(A){var z=A.find(".editNote");if(z.length==0){z=A.find(".shareForm")}var D=$("#"+z.find("[name=note_area_id]").val());z.find("[name=asin]").val(D.find(".asin").text());z.find("[name=annotation_id]").val(D.find(".annotation_id").text());z.find("[name=end_location]").val(D.find(".end_location").text());z.find("[name=note_text]").val(D.find(".noteContent").text());z.find("[name=message]").val(D.find(".noteContent").text());var C=A.find(".noteArea");if(C.length==0){C=A.find(".shareArea")}if(C.length>0){var B=C.val();C.bind("keyup",function(){if(C.val()!=B){C.unbind();w(C)}});C.focus();t(C,C.val().length)}}$("a.addEditNote").livequery(function(){$(this).amazonPopoverTrigger({ajaxSlideDuration:0,showOnHover:false,destination:this.href+"&popover=1",closeEventInclude:"CLICK_OUTSIDE",hoverShowDelay:200,width:$(this).parent().width(),location:function(C,A){var D=$(this).parents(".editNote");var E={left:D.offset().left-15,top:D.offset().top-5};var z=E.top+C.outerHeight();var B=$(window).scrollTop()+$(window).height();var F=z-B;if(F>0){window.scrollBy(0,F)}return E},cacheable:true,title:null,skin:g,onFilled:a})});$("a.shareNote").livequery(function(){$(this).amazonPopoverTrigger({ajaxSlideDuration:0,showOnHover:false,destination:this.href+"&popover=1",closeEventInclude:"CLICK_OUTSIDE",hoverShowDelay:200,width:420,location:function(C,A){var D=$(this).parents(".editNote");var E={left:D.offset().left-15,top:D.offset().top-5};var z=E.top+C.outerHeight();var B=$(window).scrollTop()+$(window).height();var F=z-B;if(F>0){window.scrollBy(0,F)}return E},cacheable:true,title:"Share Highlight & Note",skin:g,onFilled:a})});var m=function(B,A,z){$.ajax({url:A+"&popover=1",dataType:"json",success:function(C){var D=C.rows;var F=C.next;z+=C.otherCount;B.before(D);if(F!=null){m(B,F,z)}else{if(z==1){B.siblings(".otherVersionSingle").show()}else{if(z>1){var E=B.siblings(".otherVersionMultiple");E.find(".publishersNumber").text(z);E.show()}}B.hide()}}})};$("a.showPublishers").livequery(function(){$(this).amazonPopoverTrigger($.extend({},defaultPopoverOptions,{ajaxSlideDuration:0,modal:true,showOnHover:false,localContent:$("#publishersPopupInitial"),windowMargin:10,width:700,closeEventInclude:"CLICK_OUTSIDE",cacheable:false,title:"Customers with Public Notes for this Book",skin:g,paddingLeft:0,paddingRight:0,paddingBottom:0,onFilled:function(){var B=$("#publishersPopupInitial").find("a.fillPublishers");var A=B.get(0).href+"&popup=1";var z=B.parents("tr");m(z,A,0)}}))});$("a.showFriends").livequery(function(){$(this).amazonPopoverTrigger(r(this))});$("button.linkButtonPopup").livequery(function(){$(this).amazonPopoverTrigger(r(this))});$("form.networkSettingsConfirm").livequery(function(){var z=$(this);z.ajaxForm({beforeSend:function(A){A.setRequestHeader("Accept","text/javascript")},success:function(B){var A=z.parents(".linkPopup");A.html(B)},error:function(A,C,B){},resetForm:false})});$("form.setPubSub").livequery(function(){var z=$(this);z.ajaxForm({dataType:"json",beforeSend:function(A){A.setRequestHeader("Accept","text/javascript")},success:function(B){if(!B.error){if(B.active==true){z.find(".pubsubStart").addClass("hidden");z.find(".pubsubStop").removeClass("hidden");z.find(".pubsubAction").attr("value","stop");if(B.make_public==true){var A=$("#editionRelationWidget"+B.asin);A.find(".privacy input").eq(0).attr("class","publicActive");A.find(".privacy input").eq(1).attr("class","private");A.find(".privacy .text").html("Public");A.editionRelationWidget()}}else{z.find(".pubsubStart").removeClass("hidden");z.find(".pubsubStop").addClass("hidden");z.find(".pubsubAction").attr("value","start")}if(B.stats){$("#numFollowing"+B.stats[0].cid).html(B.stats[0].num_following.toString());$("#numFollowers"+B.stats[0].cid).html(B.stats[0].num_followers.toString());$("#numFollowers"+B.stats[1].cid).html(B.stats[1].num_followers.toString())}if(B.pubsub_html){$("#pubsub").html(B.pubsub_html)}}},error:function(A,C,B){},resetForm:false})});$("a.previewLink").livequery(function(){$(this).expandCollapseBelow({expandClass:"expand",expandHtml:'<span class="innerText">Preview</span>',collapseClass:"collapse",collapseHtml:'<span class="innerText">Close Preview</span>',targetId:this.rel,remote:true})});$("a.expandCollapsePublisher").livequery(function(){$(this).expandCollapseBelow({targetId:this.rel,remote:true})});$("a.expandCollapsePublisherEmpty").livequery(function(){$(this).expandCollapseBelow({targetId:this.rel})});$("a.rhtmlInHidden").livequery("click",function(){var z=this.href;var A="#"+this.rel;$.ajax({type:"get",url:z,dataType:"html",beforeSend:function(B){B.setRequestHeader("Accept","application/javascript");$(".toHide").addClass("hidden");$(A).removeClass("hidden")},success:function(B){$(A).html(B)},error:function(B,D,C){$(A).html("Sorry, something went wrong...")}});return false});$("a.seeMore").livequery("click",function(){$(this).blur();var B=$(this);var z=this.href;var A="#"+this.rel;var C=$(this).parent().parent().find(".loadingWrapper img");$.ajax({type:"get",url:z,dataType:"json",beforeSend:function(D){D.setRequestHeader("Accept","application/javascript");C.show()},success:function(D){C.hide();newspan=$("<span/>");newspan.html(D.new_html);newspan.hide();$(A).append(newspan);if(!D.show_more){B.hide()}else{B.attr("href",D.new_link_url)}newspan.show()},error:function(D,F,E){}});return false});$("a.cdCommentSort").livequery("click",function(){$(this).blur();var z=this.href;var A="#"+this.rel;var B=$(this).siblings(".cdCommentFetching").find("img");$.ajax({type:"get",url:z,dataType:"json",beforeSend:function(C){C.setRequestHeader("Accept","application/javascript");B.show()},success:function(C){B.hide();newspan=$("<span/>");newspan.html(C.new_html);newspan.hide();$(A).html(newspan);newspan.show()},error:function(C,E,D){}});return false});if($().tour){$("a.tourLink").tour("/home/tour",700)}$(".authorResponse").livequery(function(){$(this).authorResponse()});$("a.share").livequery(function(){$(this).amazonPopoverTrigger({ajaxSlideDuration:0,showOnHover:false,destination:this.href+"&popover=1",closeEventInclude:"CLICK_OUTSIDE",hoverShowDelay:200,width:420,cacheable:true,title:this.title,paddingLeft:8,paddingRight:8,paddingBottom:5,location:function(B,A){var z=this;return{left:this.offset().left-100,top:this.offset().top-20}}})});$("div.tabs").livequery(function(){$(this).tabbedContent()});$("div.countdownText").livequery(function(){$(this).countdownText()});var x=function(z){if(z.made_public){$("input[name=publicKindleWeightUncheck]").hide();$("input[name=publicKindleWeightCheck]").show();$("#publicKindleWeightLabel").attr("for","publicKindleWeightCheck")}};$("form.weightShareForm").livequery(function(){$(this).share({successFunction:x})});var o=function(z){if(z.lent_asin){if(z.redemption_url){$(".loanCreatedLink."+z.lent_asin).attr("href",z.redemption_url)}$(".loanCreated."+z.lent_asin).show();if(z.hide_share_buttons){$(".broadcastLendingLinks."+z.lent_asin).hide();$(".directLoanCreation."+z.lent_asin).hide()}}};$("form.loanShareForm").livequery(function(){$(this).share({successFunction:o})});$("form.noteShareForm").livequery(function(){$(this).share({successFunction:function(z){e(z.note_area_id,z.new_text);q(z)}})});$(".editionRelationWidget").livequery(function(){$(this).editionRelationWidget()});$(".readingStatusWidget").livequery(function(){$(this).bookStateWidget();$(this).readingStatusWidget()});$(".publicBookWidget").livequery(function(){$(this).bookStateWidget();$(this).publicBookWidget()});$(".publicNotesWidget").livequery(function(){$(this).bookStateWidget();$(this).publicNotesWidget()});$(".dropBookWidget").livequery(function(){$(this).bookStateWidget();$(this).dropBookWidget()});$(".makeAllBooksPublicWidget").livequery(function(){var z={isShareNotes:false,ajaxUrl:"/edition_relation/make_books_public",enabledId:"makePublicBooksBtnEnabled",disabledId:"makePublicBooksBtnDisabled",targetWidget:"publicBookWidget",popupTitle:"Make All Public",popupUrl:"/edition_relation/make_public_popup/books",popContinue:"continueShareBooks",popCancel:"cancelShareBooks",popClose:"closeShareBooksPopup"};$(this).makePagePublicWidget(z)});$(".makeAllNotesPublicWidget").livequery(function(){var z={isShareNotes:true,ajaxUrl:"/work/publish_page",enabledId:"makePublicNotesBtnEnabled",disabledId:"makePublicNotesBtnDisabled",targetWidget:"publicNotesWidget",popupTitle:"Make All Public",popupUrl:"/edition_relation/make_public_popup/notes",popContinue:"continueShareNotes",popCancel:"cancelShareNotes",popClose:"closeShareNotesPopup"};$(this).makePagePublicWidget(z)});$("a.whatsThis").livequery(function(){var z=$.extend({},defaultPopoverOptions,{showOnHover:true,destination:this.href,closeEventInclude:"MOUSE_LEAVE",hoverShowDelay:200,title:this.title,skin:g});if($(this).hasClass("bottomTopPopover")){z.location=["bottom","top","auto"]}$(this).amazonPopoverTrigger(z)});$(".reliableTooltip").livequery(function(){$(this).reliableTooltip()});$(".kindleReaderSampleButton").webReaderLauncher();$("a.k4pcReadMore").livequery(function(){var z=navigator.userAgent.toLowerCase();if((z.indexOf("windows")!=-1||z.indexOf("macintosh")!=-1)&&z.indexOf("opera")==-1&&z.indexOf("netfront")==-1&&z.indexOf("windows ce")==-1&&z.indexOf("windows phone")==-1){$(this).show()}});var h=function(z){var A=$("#kframe");if(A.size()==0){A=$('<iframe id="kframe"></iframe>');$("body").append(A);A.hide()}A.attr("src",z)};var n=function(){h(this.href);if(showK4pcPopup){var A="Opening in Kindle for PC...";if(navigator.userAgent.toLowerCase().indexOf("macintosh")!=-1){A="Opening in Kindle for Mac..."}var z=$("<a></a>");z.amazonPopoverTrigger($.extend({},defaultPopoverOptions,{showOnHover:false,modal:true,destination:"/work/kindle_for_pc_firefox",closeEventInclude:"CLICK_OUTSIDE",location:"centered",width:430,paddingLeft:10,paddingRight:10,paddingBottom:1,windowMargin:0,cacheable:true,skin:g,title:A,onFilled:function(B){z.fadeTo(30000,1,function(){B.find("#k4pcPopupClose").click()})}}));z.click()}return false};var b=function(){k4pcBookHref=this.href;if(showK4pcPopup){var z=$("<a></a>");z.amazonPopoverTrigger($.extend({},defaultPopoverOptions,{showOnHover:false,modal:true,destination:"/work/kindle_for_pc_ie",closeEventInclude:"CLICK_OUTSIDE",location:"centered",width:430,paddingLeft:10,paddingRight:10,paddingBottom:1,windowMargin:0,cacheable:true,skin:g}));z.click()}else{h(k4pcBookHref)}return false};if(navigator.userAgent.toLowerCase().indexOf("msie")!=-1){$("a.k4pcReadMore").livequery("click",b);$("form#k4pcDoNotShow").livequery("click",function(){h(k4pcBookHref)})}else{$("a.k4pcReadMore").livequery("click",n)}$("form#k4pcDoNotShow").livequery(function(){$(this).ajaxForm({type:"post",beforeSubmit:function(){showK4pcPopup=false;$("#k4pcPopupClose").click()}})});$("button.k4pcAppDownload").livequery("click",function(){window.open(this.name);$("#k4pcPopupClose").click()});$(".prioritySelectionForm").livequery(function(){$(this).ajaxForm({type:"post",beforeSend:function(z){z.setRequestHeader("Accept","text/javascript")}})});$(".prioritySelectionForm select").livequery("change",function(){$(this).parent().submit()});$("a.rjs").livequery("click",function(){$.ajax({url:this.href,dataType:"script",beforeSend:function(z){z.setRequestHeader("Accept","text/javascript")}});return false});$(".textAreaLimited").livequery(function(){this.limit=parseInt($(this).next().text(),10);this.callbackId=$(this).next().next().text();$(this).keydown(limitedText);$(this).keyup(limitedText);$(this).blur(limitedText)});$("form.rhtml").livequery(function(){var z=this;$(this).ajaxForm({type:"post",beforeSend:function(A){A.setRequestHeader("Accept","text/javascript")},success:function(A){$("#"+z.title).html(A)},resetForm:true})});$("select.yourBooksDisplaySelect").livequery("change",function(){location.href=this.value});$("form.rjs").livequery(function(){$(this).ajaxForm({dataType:"script",beforeSend:function(z){z.setRequestHeader("Accept","text/javascript")},resetForm:true})});$(".deleteHighlightForm").livequery(function(){$(this).ajaxForm({beforeSend:function(z){z.setRequestHeader("Accept","text/javascript")}})});$(".deleteHighlightForm button").livequery("click",function(){$(this).parent().hide();var z=$(this).parents(".highlightRow");if(z.size()==0){z=$(this).parents(".singleHighlight")}var A=0;if($(this).attr("name")=="undo"){$(this).parents(".whatIsThis").children(".thisIsPersonal").removeClass("context");$(this).parent().parent().find(".deleteHighlight").show();z.find(".removableQuote").show();z.find(".context").removeClass("context").addClass("highlight");A=1}else{$(this).parents(".whatIsThis").children(".thisIsPersonal").addClass("context");$(this).parent().parent().find(".deleteHighlightUndo").show();z.find(".removableQuote").hide();z.find(".highlight").removeClass("highlight").addClass("context");z.find(".overlappingPopularHighlight").removeClass("overlappingPopularHighlight").addClass("context");A=-1}var B=$(this).parent().parent().find("[name=asin]").attr("value");u(0,A,B);return true});$("a.feedback").livequery(function(){$(this).amazonPopoverTrigger($.extend({},defaultPopoverOptions,{width:530,showOnHover:true,destination:this.href,closeEventInclude:"CLICK_OUTSIDE",closeEventExclude:"MOUSE_LEAVE",hoverShowDelay:2000,title:this.title,skin:g,location:function(B,A){var z=$(".userNav");return{left:z.offset().left+z.outerWidth()-B.outerWidth(),top:z.offset().top}}}))});function c(B,z){var A=$(B).parent().parent().parent().parent().find(".submitFeedbackButton");if(z){A.removeClass("submitFeedbackButtonInactive")}else{A.addClass("submitFeedbackButtonInactive")}A.attr("disabled",!z)}$(".feedbackArea").livequery(function(){$(this).keyup(function(){if($(this).val().length>0){c(this,true)}else{c(this,false)}})});$("form.rjsFeedbackPopup").livequery(function(){var z=$(this);z.ajaxForm({beforeSend:function(A){A.setRequestHeader("Accept","text/javascript")},success:function(A){$("#feedbackNote").html(A);$("#feedbackNote").find("#feedbackCloseLink").click(function(){$("#feedbackNote").parent().find(".ap_custom_close").click()});window.setTimeout(function(){$("#feedbackNote").parent().find(".ap_custom_close").click()},2000)},resetForm:false})});$("form.postComment").livequery(function(){var z=$(this);z.ajaxForm({beforeSend:function(A){A.setRequestHeader("Accept","text/javascript")},success:function(A){alert("Success! "+A)}})});function k(A,B){var I=$("#seeBookViewLink");var z=0;if($(".linkNoteCount").size()>0){z=parseInt($(".linkNoteCount").text())}var J=z+A;var G=0;if($(".linkHighlightCount").size()>0){G=parseInt($(".linkHighlightCount").text())}var H=G+B;if(z!=J||G!=H){I.empty();I.append(document.createTextNode("See all "));if(H>0){var F=document.createElement("span");$(F).addClass("linkHighlightCount");var C=" highlights ";if(H==1){C=" highlight "}$(F).append(document.createTextNode(H));I.append(F);I.append(document.createTextNode(C))}if(H>0&&J>0){I.append(document.createTextNode("and "))}if(J>0){var E=document.createElement("span");$(E).addClass("linkNoteCount");var D=" notes ";if(J==1){D=" note "}$(E).append(document.createTextNode(J));I.append(E);I.append(document.createTextNode(D))}I.append(document.createTextNode("from this book"));if(J==0&&H==0){I.hide()}else{I.show()}}}function u(A,B,E){var D=$(".highlightCount"+E);var G=parseInt(D[0].firstChild.data);var H=G+B;D.text(H);var C=D.parent();var z=D.parent().html();if(G!=H&&H==1){C.html(z.substring(0,z.length-1))}else{if(G!=H&&G==1){C.html(z+"s")}}var F=$(".noteCount"+E);var G=parseInt(F[0].firstChild.data);var H=G+A;F.text(H);var C=F.parent();var z=C.html();if(G!=H&&H==1){C.html(z.substring(0,z.length-1))}else{if(G!=H&&G==1){C.html(z+"s")}}if($("#seeBookViewLink").size()>0){k(A,B)}}$("form.makePersonalForm").livequery(function(){var z=$(this);z.ajaxForm({dataType:"json",beforeSend:function(B){var A=z.parents(".highlightRow");if(A.hasClass("popularHighlight")){A.removeClass("popularHighlight").addClass("personalHighlight");A.find(".context").hide();A.find(".highlight").removeClass("highlight").addClass("overlappingPopularHighlight");A.find(".location").hide();A.find(".quote").hide();A.find(".removableQuote").show();A.find(".makePersonalForm").hide();A.find(".popularHighlightNote").text("attached");A.find(".locationOverlap").show()}B.setRequestHeader("Accept","text/javascript")},success:function(B){if(B.highlight_id!=null){var A=z.parents(".highlightRow");A.find(".readMorePhl").html(B.read_more);A.find(".editNotePhl").html(B.add_note);A.find(".deleteHighlightPhl").html(B.delete_highlight)}u(0,B.highlight_count_adjustment,B.asin)},resetForm:false})});var q=function(B){var D=B.note_area_id;noteArea=$("#"+D);editLink=noteArea.find(".addEditNote");var A=B.annotation_id;noteArea.find(".annotation_id").text(A);u(B.note_count_adjustment,0,B.asin);if(B.note_count_adjustment<0){var z=noteArea.parent().find(".editNote").size();if(z>1){noteArea.remove()}else{var C=noteArea.parents(".noteOnly");if(C){C.remove()}}}};var e=function(B,z){var A=$("#"+B);A.find(".noteContent").text(z);if(z.length>0){A.find(".addEditNote").text("Edit");A.find(".yourNote").removeClass("hidden")}else{A.find(".addEditNote").text("Add a Note");if(!A.hasClass("flashcardNote")){A.find(".yourNote").addClass("hidden")}}};$("form.rjsNoteEdit").livequery(function(){var z=$(this);z.ajaxForm({dataType:"json",beforeSend:function(A){z.find(".editNoteCloseButton").click();e(z.find("[name=note_area_id]").val(),z.find("[name=note_text]").attr("value"));A.setRequestHeader("Accept","text/javascript")},success:function(A){q(A)},resetForm:false})});$("a.rhtml").livequery("click",function(){var A="#"+this.rel;var z=this.href;$.ajax({type:"get",url:z,beforeSend:function(B){B.setRequestHeader("Accept","application/javascript")},success:function(B){$(A).html(B)}});return false});$(".noFocus").livequery("click",function(){$(this).blur()});$(".selectSubmit").livequery("change",function(z){location.href=z.target.options[z.target.selectedIndex].value});$(".radioSubmit").livequery("change",function(z){location.href=z.target.value});$("button.textSubmit").livequery(function(){$(this).hover(function(){$(this).addClass("textSubmitHover")},function(){$(this).removeClass("textSubmitHover")})});$("a.expand, a.collapse").livequery(function(){$(this).hover(function(){$(this).find(".innerText").addClass("innerTextHover")},function(){$(this).find(".innerText").removeClass("innerTextHover")})});$("#seeMoreForm").livequery(function(){var z=this;$(this).ajaxForm({type:"post",beforeSend:function(A){A.setRequestHeader("Accept","text/javascript")},success:function(A){$(".seeMoreLink").remove();$(".seeMoreLoading").remove();var B=$(".seeMoreItem").size()-1;$(".seeMoreItem:last").after(A)},resetForm:true})});$("#seeMoreForm a").livequery("click",function(){$(".seeMoreLink").hide();$(".seeMoreLoading").show();$("#seeMoreForm").submit();return false});$(".userRatingWidget").livequery(function(){$(this).starRating()});$("form.dismissNag").livequery(function(){var z=$(this);z.ajaxForm({type:"post",dataType:"json",beforeSend:function(A){A.setRequestHeader("Accept","text/javascript")},success:function(A){z.parents(".nag").hide()},error:function(A,C,B){}})});$("a.cdAddComment").livequery("click",function(){var B=$(this);var A=$(this).attr("data-post");var z=$("#actions"+A);var C=$("#commentArea"+A);if(C.length<1){var B=$(this);$.ajax({url:this.href,type:"GET",success:function(D){z.prepend(D)}})}else{$("html, body").animate({scrollTop:C.offset().top-100},300)}return false});var s;var d;if(document.location.hash=="#findFriendsTwitter"){s="twitter";d="People You Follow on Twitter"}else{if(document.location.hash=="#findFriendsFacebook"){s="facebook";d="People You Know on Facebook"}else{if(document.location.hash=="#findFriendsLinkedIn"){s="linkedin";d="Your Connections on LinkedIn"}else{if(document.location.hash=="#shareFacebook"){$(".shareFacebook").click()}else{if(document.location.hash=="#shareTwitter"){$(".shareTwitter").click()}else{if(document.location.hash.indexOf("#loanFacebook")==0){$(".shareFacebook."+document.location.hash.substring(14)).click()}else{if(document.location.hash.indexOf("#loanTwitter")==0){$(".shareTwitter."+document.location.hash.substring(13)).show();$(".shareTwitter."+document.location.hash.substring(13)).click()}else{if(document.location.hash.indexOf("#share")==0){var v=document.location.hash.substring(6);$("#"+v).find(".shareNote").click()}}}}}}}}if(s!=null){var p=/photo_import_status=\w*/;var l=p.exec(document.location.search);var f=r(null,"/home/friends?type="+s+"&just_returned=1"+(l?("&"+l[0]):""),d);var i=$.AmazonPopover.displayPopover(f)}}$(document).ready(readyFunction);
/* Copyright Amazon.com 2011 */
$.fn.bookStateWidget=function(){return this.each(function(){var a=this;$.extend(this,{asin:$("input[name=asin]",a).attr("value"),url:$("form",a).attr("action"),publicNotesWidget:null,publicBookWidget:null,bookStatusWidget:null,dropBookWidget:null,findRelatedWidgets:function(){a.publicNotesWidget=$("#publicNotesWidget"+a.asin)[0];a.publicBookWidget=$("#publicBookWidget"+a.asin)[0];a.bookStatusWidget=$("#readingStatusWidget"+a.asin)[0];a.dropBookWidget=$("#dropBookWidget"+a.asin)[0]}});this.findRelatedWidgets()})};
/* Copyright Amazon.com 2010 */
$.fn.editionRelationWidget=function(){function a(c){if(!$(c).attr("class").match(/Active\b/)){$(c).attr("class",$(c).attr("class").replace(c.name,c.name+"Active"))}}function b(c){$(c).attr("class",$(c).attr("class").replace(c.name+"Active",c.name))}return this.each(function(){var c=this;$.extend(this,{activeStatus:null,activePrivacy:null,statusHasChanged:false,privacyHasChanged:false,saving:false,asin:$("input[name=asin]",c).attr("value"),url:$("form",c).attr("action"),fetchCounts:true,kindleOnly:$("input[name=kindle_only]",c).attr("value"),init:function(){c.setStateFromForm();$("input",c).removeAttr("disabled").hover(function(){$(".text",$(this).parent()).text(this.alt);a(this)},c.redraw).click(c.inputClick);c.redraw()},markReadIfUnknown:function(){if(c.activeStatus===null||c.activeStatus.name==="drop"){c.activeStatus=$("input[name=read]",c).get(0);c.redraw()}},setStateFromForm:function(){$(".status  input",c).each(function(){if($(this).attr("class").search(/Active\b/)!=-1){c.activeStatus=this}});$(".privacy input",c).each(function(){if($(this).attr("class").search(/Active\b/)!=-1){c.activePrivacy=this}})},inputClick:function(){var e=true;$(this).blur();if($(this).parent().hasClass("status")){c.activeStatus=this;c.statusHasChanged=true}else{fetchCounts=false;var d=c.activePrivacy.name;c.activePrivacy=this;e=c.activeStatus!==null&&c.activeStatus.name!=="drop"&&d!==c.activePrivacy.name;c.privacyHasChanged=true}if(e){c.submit()}c.redraw();return false},setActiveStatus:function(d){c.activeStatus=$(".status input[name="+d+"]",c).get(0)},setActivePrivacy:function(d){c.activePrivacy=$(".privacy input[name="+d+"]",c).get(0)},submit:function(){var d={fetch_counts:c.fetchCounts,asin:c.asin,kindle_only:c.kindleOnly};if(c.activePrivacy!==null){d.privacy=c.activePrivacy.name}else{d.privacy="undecided"}d[c.activeStatus.name]=true;if(!c.statusHasChanged&&c.privacyHasChanged){$(".privacy .text",c).hide();$(".status .text",c).show();$(".privacy .savingText",c).show()}else{$(".status .text",c).hide();$(".status .savingText",c).show();$(".privacy .text",c).show()}$(".errorText",c).hide();c.statusHasChanged=false;c.privacyHasChanged=false;$.ajax({type:"post",url:c.url,beforeSend:function(e){e.setRequestHeader("Accept","text/javascript")},dataType:"json",data:d,success:function(e){if(e.counts){for(i=1;i<=e.counts.length;i++){$("#readingListCount"+i).text(e.counts[i])}$("#readingListCountTotal").text(e.sum);$("#readingListCountUndecided").text(e.undecided)}$(".savingText",c).hide();$(".text",c).show();if(e.notes_dropped){c.changeNotePrivacy()}c.redraw()},error:function(e){$(".savingText:visible",c).hide().next(".errorText").show();c.redraw()}})},changeNotePrivacy:function(){var e=$("form.setPubSub");if(e.find(".pubsubAction").attr("value")==="stop"){e.find(".pubsubStart").removeClass("hidden");e.find(".pubsubStop").addClass("hidden");e.find(".pubsubAction").attr("value","start");var d=$("#subscriberLink .showPublishers");if(d.html()-1>1){d.html(d.html()-1)}else{if(d.html()-1==1){d.html(d.html()-1);$("#customerText").html("customer has")}else{d.parent().html("0");$("#customerText").html("customers have")}}}},redraw:function(){$("input",c).each(function(){b(this)});var e="&nbsp;";var d="&nbsp;";if(c.activeStatus!==null){e=c.activeStatus.alt;a(c.activeStatus);$("input[name=drop]",c).fadeIn();if(c.activeStatus.name==="drop"){$(".privacy",c).hide();c.setActivePrivacy("private")}else{if(c.activePrivacy!==null){d=c.activePrivacy.alt;a(c.activePrivacy)}$(".privacy",c).show()}}else{$(".privacy",c).hide()}$(".status .text",c).html(e);$(".privacy .text",c).html(d)}});this.init()})};
/* Copyright Amazon.com 2011 */
$.fn.readingStatusWidget=function(){function a(c){if(!$(c).attr("class").match(/Active\b/)){$(c).attr("class",$(c).attr("class").replace(c.name,c.name+"Active"))}}function b(c){$(c).attr("class",$(c).attr("class").replace(c.name+"Active",c.name))}return this.each(function(){var c=this;$.extend(this,{activeStatus:null,statusHasChanged:false,inputDisabled:false,kindleOnly:$("input[name=kindle_only]",c).attr("value"),init:function(){c.setStateFromForm();$("input",c).removeAttr("disabled").hover(function(){if(!c.inputDisabled){$(".text",$(this).parent()).text(this.alt);a(this)}},c.redraw).click(c.inputClick);c.redraw()},enable:function(){c.inputDisabled=false;c.redraw()},disable:function(){c.inputDisabled=true;c.redraw()},currentState:function(){return c.activeStatus.name},setStateFromForm:function(){$(".status  input",c).each(function(){if($(this).attr("class").search(/Active\b/)!=-1){c.activeStatus=this}})},inputClick:function(){if(!c.inputDisabled){$(this).blur();c.activeStatus=this;c.statusHasChanged=true;c.submit();c.redraw()}return false},submit:function(){var d={asin:c.asin,kindle_only:c.kindleOnly};d[c.activeStatus.name]=true;if(c.statusHasChanged){$(".status .text",c).hide();$(".status .savingText",c).show()}$(".errorText",c).hide();c.statusHasChanged=false;$.ajax({type:"post",url:c.url,beforeSend:function(e){e.setRequestHeader("Accept","text/javascript")},dataType:"json",data:d,success:function(e){if(e.counts){for(i=1;i<=e.counts.length;i++){$("#readingListCount"+i).text(e.counts[i])}$("#readingListCountTotal").text(e.sum);$("#readingListCountUndecided").text(e.undecided)}$(".savingText",c).hide();$(".text",c).show();c.redraw()},error:function(e){$(".savingText:visible",c).hide().next(".errorText").show();c.redraw()}})},redraw:function(){$("input",c).each(function(){b(this)});var d="&nbsp;";if(!c.inputDisabled&&c.activeStatus!==null){d=c.activeStatus.alt;a(c.activeStatus);$("input[name=drop]",c).fadeIn()}$(".status .text",c).html(d)}});this.init()})};
/* Copyright Amazon.com 2011 */
$.fn.publicNotesWidget=function(){return this.each(function(){var a=this;$.extend(this,{state:null,stateBeforeSave:null,stateBeforeDisable:null,init:function(){a.setStateFromForm();$("input",a).click(a.inputClick);a.redraw()},setStateFromForm:function(){$(".status  input",a).each(function(){if(!$(this).hasClass("hidden")){a.state=this}})},disable:function(b){a.stateBeforeDisable=a.state.name;if(b){a.setState(b)}else{if(a.state.name=="public"){a.setState("publicDisabled")}else{if(a.state.name=="private"){a.setState("privateDisabled")}}}a.redraw()},enable:function(){if(a.stateBeforeDisable){a.setState(a.stateBeforeDisable);a.stateBeforeDisable=null}else{if(a.state.name=="publicDisabled"){a.setState("public")}else{if(a.state.name=="privateDisabled"){a.setState("private")}}}a.redraw()},currentState:function(){if(a.state.name.search("public")!=-1){return"public"}else{return"private"}},inputClick:function(){$(this).blur();if(a.state.name.search(/Disabled\b/)==-1){a.stateBeforeSave=a.state.name;if(a.state.name=="public"){a.setState("private");a.publicBookWidget.enable()}else{if(a.state.name=="private"){a.setState("public");a.publicBookWidget.disable()}}a.redraw();a.submit()}return false},setState:function(b){a.state=$(".status input[name="+b+"]",a).get(0)},submit:function(){var c="stop";if(a.state.name=="public"){c="start"}var b={asin:a.asin,publish:c};var d=$("#makeAllNotesPublicWidget")[0];if(d){d.refreshButtonState()}$.ajax({type:"post",url:a.url,beforeSend:function(e){e.setRequestHeader("Accept","text/javascript")},dataType:"json",data:b,success:function(e){a.stateBeforeSave=null},error:function(e){a.setState(a.stateBeforeSave);if(d){d.refreshButtonState()}a.redraw()}})},redraw:function(){$("input",a).each(function(){$(this).hide()});if(a.state!==null){$(a.state).show()}}});this.init()})};
/* Copyright Amazon.com 2011 */
$.fn.publicBookWidget=function(){return this.each(function(){var a=this;$.extend(this,{state:null,stateBeforeSave:null,stateBeforeDisable:null,init:function(){a.setStateFromForm();$("input",a).click(a.inputClick);a.redraw()},setStateFromForm:function(){$(".status  input",a).each(function(){if(!$(this).hasClass("hidden")){a.state=this}})},inputClick:function(){$(this).blur();if(a.state.name.search(/Disabled\b/)==-1){a.stateBeforeSave=a.state.name;if(a.state.name=="public"){a.setState("private");if(a.publicNotesWidget!==undefined){a.publicNotesWidget.disable()}}else{if(a.state.name=="private"){a.setState("public");if(a.publicNotesWidget!==undefined){a.publicNotesWidget.enable()}}}a.redraw();a.submit()}return false},disable:function(b){a.stateBeforeDisable=a.state.name;if(b){a.setState(b)}else{if(a.state.name=="public"){a.setState("publicDisabled")}else{if(a.state.name=="private"){a.setState("privateDisabled")}}}a.redraw()},enable:function(){if(a.stateBeforeDisable){a.setState(a.stateBeforeDisable);a.stateBeforeDisable=null}else{if(a.state.name=="publicDisabled"){a.setState("public")}else{if(a.state.name=="privateDisabled"){a.setState("private")}}}a.redraw()},currentState:function(){if(a.state.name.search("public")!=-1){return"public"}else{return"private"}},setState:function(b){a.state=$(".status input[name="+b+"]",a).get(0)},submit:function(){var d="private";if(a.state.name=="public"){d="public"}var b={asin:a.asin,privacy:d};var c=$("#makeAllBooksPublicWidget")[0];if(c){c.refreshButtonState()}$.ajax({type:"post",url:a.url,beforeSend:function(e){e.setRequestHeader("Accept","text/javascript")},dataType:"json",data:b,success:function(e){a.stateBeforeSave=null},error:function(e){a.setState(a.stateBeforeSave);if(c){c.refreshButtonState()}a.redraw()}})},redraw:function(){$("input",a).each(function(){$(this).hide()});if(a.state!==null){$(a.state).show()}}});this.init()})};
/* Copyright Amazon.com 2011 */
$.fn.dropBookWidget=function(){function a(c){if(!$(c).attr("class").match(/Active\b/)){$(c).attr("class",$(c).attr("class").replace(c.name,c.name+"Active"))}}function b(c){$(c).attr("class",$(c).attr("class").replace(c.name+"Active",c.name))}return this.each(function(){var c=this;$.extend(this,{state:null,stateBeforeSave:null,undoData:{},kindleOnly:$("input[name=kindle_only]",c).attr("value"),init:function(){c.state="in_list";$("input",c).removeAttr("disabled").hover(function(){a(this)},c.redraw).click(c.dropClick);$(".undoDrop",c).click(c.undoClick);c.redraw()},disableRelatedWidgets:function(){c.bookStatusWidget.disable();if(c.publicNotesWidget!==undefined){c.publicNotesWidget.disable("privateDisabled")}c.publicBookWidget.disable("privateDisabled")},dropClick:function(){$(this).blur();if($(this).hasClass("drop")||$(this).hasClass("dropActive")){c.stateBeforeSave=c.state;c.state="dropped";c.undoData={status:c.bookStatusWidget.currentState(),book_privacy:c.publicBookWidget.currentState()};if(c.publicNotesWidget!==undefined){c.undoData.notes_privacy=c.publicNotesWidget.currentState()}c.disableRelatedWidgets()}c.submit();c.redraw();return false},restoreRelatedWidgets:function(){c.bookStatusWidget.enable();if(c.publicNotesWidget!==undefined){c.publicNotesWidget.enable()}if(c.publicBookWidget!==undefined){c.publicBookWidget.enable()}},undoClick:function(){$(this).blur();if($(this).hasClass("undoDrop")){c.stateBeforeSave=c.state;c.state="in_list";c.restoreRelatedWidgets()}c.submit();c.redraw();return false},submit:function(){var d={fetch_counts:true,asin:c.asin,kindle_only:c.kindleOnly};if(c.state=="dropped"){d.drop=true}else{d.undoDrop=true;d.status=c.undoData.status;d.book_privacy=c.undoData.book_privacy;if(c.undoData.notes_privacy!==undefined){d.notes_privacy=c.undoData.notes_privacy}}$.ajax({type:"post",url:c.url,beforeSend:function(e){e.setRequestHeader("Accept","text/javascript")},dataType:"json",data:d,success:function(e){if(e.counts){for(i=1;i<=e.counts.length;i++){$("#readingListCount"+i).text(e.counts[i])}$("#readingListCountTotal").text(e.sum);$("#readingListCountUndecided").text(e.undecided)}c.stateBeforeSave=null;c.redraw()},error:function(e){c.state=c.stateBeforeSave;if(c.state=="dropped"){c.disableRelatedWidgets()}else{c.restoreRelatedWidgets()}c.redraw()}})},redraw:function(){$("input",c).each(function(){b(this)});$(".status .undoDrop",c).hide();if(c.state=="dropped"){a($(".status input[name=drop]",c).get(0));$(".status .undoDrop",c).show()}}});this.init()})};
/* Copyright Amazon.com 2011 */
$.fn.makePagePublicWidget=function(a){return this.each(function(){var b=this;$.extend(this,{popup:null,enabled:null,isShareNotes:a.isShareNotes,ajaxUrl:a.ajaxUrl,enabledId:a.enabledId,disabledId:a.disabledId,targetWidget:a.targetWidget,popupTitle:a.popupTitle,popupUrl:a.popupUrl,popContinue:a.popContinue,popCancel:a.popCancel,popClose:a.popClose,popUpOptions:function(){return{showOnHover:false,title:b.popupTitle,ajaxSlideDuration:0,modal:true,showCloseButton:false,closeEventExclude:"CLICK_OUTSIDE",destination:b.popupUrl,windowMargin:10,width:400,cacheable:false,skin:$.browser.msie&&$.browser.version<7?"classic":"default",paddingLeft:0,paddingRight:0,paddingBottom:0,loadingContent:"<div class='popoverLoading'><img src='https://images-na.ssl-images-amazon.com/images/G/01/javascripts/lib/popover/images/snake._V265110081_.gif' /></div>"}},init:function(){b.refreshButtonState();$("input#"+b.enabledId,b).hover(b.onHover,b.onOut);$("img#"+b.disabledId,b).hover(b.onHover,b.onOut);$("input#"+b.enabledId,b).click(b.inputClick);$("#"+b.popContinue).livequery("click",function(){b.submit()});$("#"+b.popCancel).livequery("click",function(){b.popup.close()});$("#"+b.popClose).livequery("click",function(){b.popup.close()})},refreshButtonState:function(){if(b.getPrivateAsins().length==0){b.enabled=false;$("#"+b.disabledId).show();$("#"+b.enabledId).hide()}else{b.enabled=true;$("#"+b.disabledId).hide();$("#"+b.enabledId).show()}},getPrivateAsins:function(){var c=new Array();$("."+b.targetWidget).each(function(){if(this.currentState()=="private"){var d=this.asin;if($("#dropBookWidget"+d)[0].state=="in_list"){c.push(d)}}});return c},inputClick:function(){if(b.enabled){b.popup=$.AmazonPopover.displayPopover(b.popUpOptions());return false}},onHover:function(f){var g=(b.enabled?b.enabledId:b.disabledId)+"Tooltip";var d=0;if(document.body&&document.body.offsetWidth){d=document.body.offsetWidth}if(document.compatMode=="CSS1Compat"&&document.documentElement&&document.documentElement.offsetWidth){d=document.documentElement.offsetWidth}if(window.innerWidth&&window.innerHeight){d=window.innerWidth}var c=0;if(f.pageX){c=f.pageX}else{c=f.clientX}if(d-c<234){$("#"+g,b).addClass("tooltipLeft")}else{$("#"+g,b).addClass("tooltipRight")}$("#"+g,b).show()},onOut:function(){$(".tooltip",b).hide();$(".tooltip",b).removeClass("tooltipLeft");$(".tooltip",b).removeClass("tooltipRight")},submit:function(){$("#"+b.popContinue).hide();$("#"+b.popCancel).hide();$(".popupMessage").hide();$("#processingMakePublic").addClass("showProcessingMakePublic");$("#"+b.enabledId).hide();$("#"+b.disabledId).show();asinList=b.getPrivateAsins();var c={asins:asinList.toString()};$.ajax({type:"post",url:b.ajaxUrl,beforeSend:function(d){d.setRequestHeader("Accept","text/javascript")},dataType:"json",data:c,success:function(d){b.enabled=false;success=b.updateChecks(asinList,d);if(!success){b.errorOccured()}else{if(b.popup){b.popup.close()}}},error:function(d){b.errorOccured()}})},errorOccured:function(){b.refreshButtonState();$(".popupError").show();$("#processingMakePublic").hide()},updateChecks:function(e,h){var k=true;for(var f=0;f<e.length;f++){var j=e[f];if(h[j]){if(b.isShareNotes){var c=$("#publicBookWidget"+e[f])[0];c.setState("publicDisabled");c.redraw()}if(!b.isShareNotes){var d=$("#publicNotesWidget"+e[f])[0];if(d){d.enable()}}var g=$("#"+b.targetWidget+e[f])[0];g.setState("public");g.redraw()}else{k=false}}if(b.isShareNotes){$("#makeAllBooksPublicWidget")[0].refreshButtonState()}return k}});this.init()})};
/* Copyright Amazon.com 2010 */
var usedAsins=[];var upcomingAsins=[];var currentOffset=0;var readyForNextBook=true;function addNextBook(){readyForNextBook=false;var a={"used_asins[]":usedAsins,current_offset:currentOffset};if(upcomingAsins.length>0){a["upcoming_asins[]"]=upcomingAsins}$.ajax({url:"/your_highlights/next_book",data:a,success:function(e){if(e.length==0){$("#stillLoadingBooks").remove()}else{$("#allHighlightedBooks").append(e);var d=e.indexOf('id="',0)+4;var b=e.indexOf('"',d);var c=$("#"+e.substring(d,b));recordLatestState(c);if(nearPageBottom()){addNextBook()}else{readyForNextBook=true}}}})}function recordLatestState(b){var a=b.attr("id");var c=a.split("_")[0];var d=parseInt(a.split("_")[1]);usedAsins.push(c);currentOffset=d;if(b.find(".skipped").size()==1){usedAsins.push(b.find(".skipped").text())}upcomingAsins=b.find(".upcoming").text().split(",")}function nearPageBottom(){return $(window).scrollTop()>=$(document).height()-($(window).height()*2)}$(document).ready(function(){$("#nextBookLink").addClass("hidden");$("#stillLoadingBooks").removeClass("hidden");if($("#allHighlightedBooks").size()==1){window.scrollTo(0,0);$("#allHighlightedBooks").find(".yourHighlightsHeader").each(function(b,a){recordLatestState($(a))});if(nearPageBottom()){addNextBook()}}$(window).scroll(function(){if($("#allHighlightedBooks").size()==1){if(nearPageBottom()&&readyForNextBook){addNextBook()}}})});
$(document).ready(function(){$("form.preferencesForm").livequery(function(){var a=this;$(a).find(".preference").each(function(){var b=this;function c(g,h){data={};var d=$(b).find("input[name^='"+g+"Check']").get(0);var f=$(b).find("input[name^='"+g+"Uncheck']").get(0);var e=$(b).find("#"+g+"Label").get(0);if(h){data[f.name]=true}else{data[d.name]=true}$.ajax({type:"post",url:a.action,dataType:"json",data:data,beforeSend:function(i){i.setRequestHeader("Accept","text/javascript");if(h){$(f).hide();$(d).show();$(e).attr("for",d.name)}else{$(d).hide();$(f).show();$(e).attr("for",f.name)}}})}$(b).find("input[name$='Check']").click(function(){c(this.name.substr(0,this.name.length-5),false);return false});$(b).find("input[name$='Uncheck']").click(function(){c(this.name.substr(0,this.name.length-7),true);return false})})});$("#homeWrapper form.selectPreferredForm").livequery(function(){var b=this;var d=$(b).find("select[name=preferredDevice]").val();function c(){$(b).find(".savePreferredDevice").attr("disabled","disabled").addClass("savePreferredInactive")}function a(){$(b).find(".savePreferredDevice").removeAttr("disabled").removeClass("savePreferredInactive")}$(this).ajaxForm({type:"post",beforeSend:function(f,e){f.setRequestHeader("Accept","text/javascript");c()},success:function(e){a();d=$(b).find("select[name=preferredDevice]").val()},error:function(){a();$(b).find("select[name=preferredDevice]").val(d)}})});$("#homeWrapper form.networkDeregister").livequery(function(){var a=$(this).parents(".network");$(this).ajaxForm({type:"post",beforeSend:function(c,b){c.setRequestHeader("Accept","text/javascript");a.find(".errorNotification ").fadeOut("fast");a.find(".errorMessage").fadeOut("fast");a.find(".username").fadeOut("fast");a.find(".forms").fadeOut("fast",function(){a.find(".credentials input").attr("value","");a.find(".credentials").show();a.find(".link").show();a.find(".unlink").hide();a.find(".fix").hide();a.find(".networkSettingsUpdate").hide();a.find(".forms").fadeIn("fast")})}})});$("#homeWrapper form.networkSettingsUpdate input.auto_post").livequery("click",function(){var a=$(this).parents(".networkSettingsUpdate");$.ajax({type:"post",url:a.attr("action"),data:a.serialize(),beforeSend:function(c,b){c.setRequestHeader("Accept","text/javascript");a.find(".autoPostSaving").show();a.find(".autoPostSaved").hide();a.find(".autoPostError").hide()},success:function(b){a.find(".autoPostSaving").hide();a.find(".autoPostSaved").show()},error:function(){a.find(".autoPostSaving").hide();a.find(".autoPostError").show()}})})});
(function(d){var a={"delete_rating.x":0,"star_1.x":1,"star_2.x":2,"star_3.x":3,"star_4.x":4,"star_5.x":5};function b(f,e){for(i=1;i<=5;i++){var g=f.find("[name=star_"+i+"]");if(i<=e){g.attr("src","https://images-na.ssl-images-amazon.com/images/G/01/reading/images/filled-star._V349054554_.gif")}else{g.attr("src","https://images-na.ssl-images-amazon.com/images/G/01/reading/images/empty-star._V349054878_.gif")}}}function c(e){d("#editionRelationWidget"+e.find("[name=asin]").val()).each(function(){this.markReadIfUnknown()})}d.fn.starRating=function(e){var f={saveInFade:100,saveOutFade:2000};var e=d.extend(f,e);return this.each(function(){var l=d(this);var k=l.find("[name=old_num_stars]").val();var h=l.find(".deleteRating");var j=l.find(".userRatingProgressText");var g=l.find("[name^=star_]");g.mouseover(function(){var m=d(this).attr("name");var n=m.substring(m.length-1);b(l,n)});g.mouseout(function(){b(l,k)});l.ajaxForm({type:"post",beforeSend:function(m){m.setRequestHeader("Accept","text/javascript")},beforeSubmit:function(n){var m=null;d.each(n,function(p,o){m=a[o.name];if(m!=null){return false}});k=m;b(l,m);j.stop();j.text("Saving");j.fadeTo(e.saveInFade,1);m==0?h.hide():h.show()},success:function(m){c(l);j.text("Saved");j.fadeTo(e.saveOutFade,0)},failure:function(){ratingText.text("Failed to save")},resetForm:true})})}})(jQuery);
(function(a){a.fn.reliableTooltip=function(b){var c={showOnHover:true,literalContent:"",hoverShowDelay:500,title:null,skin:null,location:"right",locationMargin:0,width:null};var b=a.extend(c,b);return this.each(function(){var d=b;var e=a(this);d.literalContent='<p class="reliableTooltipText">'+this.title+"</p>";this.title="";e.amazonPopoverTrigger(d)})}})(jQuery);
(function(a){a.fn.authorResponse=function(b){var c={};var b=a.extend(c,b);return this.each(function(){var e=b;var d=this;var f=a(this);a.extend(this,{latestSavedText:null,editView:a(d).find(".editNote"),viewView:a(d).find(".viewNote"),textArea:a(d).find(".editNote").find(".authorNoteArea"),clearEditMessages:function(){d.editView.find(".saveErrorMessage").hide();d.editView.find(".deleteSuccessMessage").hide()},showSaveError:function(){d.editView.find(".saveErrorMessage").show()},showDeleteSuccess:function(){d.editView.find(".deleteSuccessMessage").show()},resetEditForm:function(){d.latestSavedText=d.textArea.val();var g=d.editView.find(".postResponseButton");g.addClass("postResponseButtonInactive");g.attr("disabled",true);d.textArea.bind("keyup",function(){if(d.textArea.val()!=d.latestSavedText){d.textArea.unbind();g.removeClass("postResponseButtonInactive");g.attr("disabled",false)}})},startEditing:function(){d.textArea.val(d.viewView.find(".noteContent").text());d.editView.removeClass("hidden");d.viewView.addClass("hidden");return false},finishEditing:function(){d.viewView.find(".noteContent").text(d.textArea.val());d.editView.addClass("hidden");d.viewView.removeClass("hidden")},updateTimestamp:function(g){d.viewView.find(".sharedOn").text(g)}});d.resetEditForm();a(d).find(".editResponseButton").click(d.startEditing);a(d).find(".editForm").ajaxForm({dataType:"json",beforeSend:function(g){d.clearEditMessages();if(d.textArea.val().length>0){d.finishEditing()}g.setRequestHeader("Accept","text/javascript")},success:function(g){d.resetEditForm();d.updateTimestamp(g.timestamp);if(d.textArea.val().length==0){d.showDeleteSuccess()}},error:function(g,i,h){d.startEditing();d.showSaveError()},resetForm:false})})}})(jQuery);
(function(a){a.fn.share=function(b){var c={successFunction:null};var b=a.extend(c,b);return this.each(function(){var e=b;var d=this;var f=a(this);a.extend(this,{disableAllInputs:function(){a(".shareSending",f).show();a("a.shareCancelButton",f).addClass("shareCancelButtonDisabled");a("input[name=shareButton]",f).addClass("shareButtonDisabled");a("textarea, input",f).attr("disabled","disabled")},enableAllInputs:function(){a(".shareSending",f).hide();a("a.shareCancelButton",f).removeClass("shareCancelButtonDisabled");a("input[name=shareButton]",f).removeClass("shareButtonDisabled");a("textarea, input",f).attr("disabled",null)},hideError:function(){a(".error",f).hide()},showError:function(g){a(".error").html(g).show()}});f.ajaxForm({type:"post",dataType:"json",beforeSend:function(g){g.setRequestHeader("Accept","text/javascript");d.disableAllInputs();d.hideError()},success:function(g){if(e.successFunction){e.successFunction(g)}if(g.error){d.showError(g.error);d.enableAllInputs()}else{a(".ap_custom_close",f[0]).click()}},error:function(g,i,h){d.showError("Something went wrong, please try again");d.enableAllInputs()}});f.find(".shareArea").focus()})}})(jQuery);
(function(a){a.fn.tabbedContent=function(){return this.each(function(){var b=this;var d=a(this);var c=function(){return a("li",d)};c().tab({tabbedContent:b});a.extend(this,{showSelectedTab:function(){for(var e=0;e<c().length;e++){c()[e].setTabVisibility()}},deselectAll:function(){for(var e=0;e<c().length;e++){c()[e].setSelected(false)}}});b.showSelectedTab()})}})(jQuery);(function(a){a.fn.tab=function(b){return this.each(function(){var d=b;var c=this;var e=a(this);a.extend(this,{contentTabClass:"."+a("a",e)[0].rel,contentTab:function(){return a(d.tabbedContent).siblings(c.contentTabClass)},setTabVisibility:function(){if(e.hasClass("tabSelected")){c.contentTab().show()}else{c.contentTab().hide()}},setSelected:function(f){if(f){e.addClass("tabSelected")}else{e.removeClass("tabSelected")}}});a("a",e).livequery("click",function(){d.tabbedContent.deselectAll();c.setSelected(true);d.tabbedContent.showSelectedTab();return false})})}})(jQuery);
(function(a){a.fn.countdownText=function(){return this.each(function(){var b=this;var d=a(this);var e=a(".shareRemaining .number",d);var c=a(".shareRemaining .minimum",d);a.extend(this,{textArea:a(".shareArea",d),remainingNumber:e,shareButton:a(".shareButton",d),minChars:parseInt(c.text()),maxChars:parseInt(e.text()),updateRemaining:function(f){var g=b.textArea[0].value.length;var h=b.maxChars-g;b.remainingNumber.text(h);if(g<b.minChars){b.shareButton.addClass("shareButtonDisabled");b.shareButton.attr("disabled","disabled");b.remainingNumber.parent().removeClass("overflow")}else{if(h>=0){b.remainingNumber.parent().removeClass("overflow");b.shareButton.removeClass("shareButtonDisabled");b.shareButton.attr("disabled","")}else{b.remainingNumber.parent().addClass("overflow");b.shareButton.addClass("shareButtonDisabled");b.shareButton.attr("disabled","disabled")}}}});b.textArea.livequery("keyup",function(){b.updateRemaining("keyup")});b.updateRemaining()})}})(jQuery);